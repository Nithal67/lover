<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notre Petit Monde ğŸ’–</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<style>
body { margin:0; font-family:'Poppins',sans-serif; background:#ffeef2; color:#333; }
header { background:#ff6b81; color:white; text-align:center; padding:20px; font-family:'Great Vibes', cursive; font-size:2em; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
nav { display:flex; justify-content:center; flex-wrap:wrap; margin:20px 0; }
nav button { background:#fff0f5; border:none; border-radius:30px; padding:12px 25px; margin:5px; cursor:pointer; font-weight:600; font-size:1em; transition:all 0.3s; box-shadow:0 3px 6px rgba(0,0,0,0.1); }
nav button:hover { background:#ffb6c1; color:white; transform:scale(1.05); }
.section { display:none; padding:0 20px 40px; transition:opacity 0.5s; }
.section.active { display:block; }

/* Souvenirs */
button.add-btn { display:block; margin:20px auto; padding:12px 25px; border-radius:25px; background:#ff6b81; color:white; border:none; cursor:pointer; font-weight:bold; font-size:1em; transition:0.3s; }
button.add-btn:hover { background:#ff4757; transform:scale(1.05); }
.events-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px; }
.event-card { background:#fff0f5; border-radius:20px; overflow:hidden; cursor:pointer; box-shadow:0 4px 15px rgba(0,0,0,0.1); display:flex; flex-direction:column; transition:transform 0.3s, box-shadow 0.3s; }
.event-card:hover { transform:translateY(-5px); box-shadow:0 6px 20px rgba(0,0,0,0.2);}
.event-card img, .event-card video { width:100%; height:180px; object-fit:cover; }
.event-card .event-info { padding:10px; text-align:center; }
.event-card .event-info h3 { color:#ff6b81; font-family:'Great Vibes', cursive; margin:5px 0; }
.event-card .event-info p { margin:3px 0; font-size:0.85em; color:#555; }

/* Popup */
.popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000; }
.popup-content { background:white; border-radius:20px; max-width:90%; max-height:90%; overflow-y:auto; padding:20px; text-align:center; }
.popup-close { background:#ff6b81; color:white; border:none; border-radius:20px; padding:8px 15px; margin-bottom:10px; cursor:pointer; }
.add-popup input, .add-popup button { width:90%; margin:8px 0; padding:12px; border-radius:20px; border:1px solid #ffc0cb; font-size:1em; box-sizing:border-box; }
.add-popup button { background:#ff6b81; color:white; border:none; cursor:pointer; font-weight:bold; transition:0.3s; }
.add-popup button:hover { background:#ff4757; }

/* Chat */
.chat-container { display:flex; flex-direction:column; max-height:400px; overflow-y:auto; background:#fff0f5; padding:15px; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1); margin-bottom:10px; }
.message { max-width:70%; margin:5px 0; padding:12px; border-radius:20px; background:#ffb6c1; align-self:flex-start; position: relative; animation:appear 0.3s ease-out; }
.message.me { background:#ffe0e6; align-self:flex-end; }
@keyframes appear { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
textarea { border-radius:20px; border:1px solid #ffc0cb; resize:none; padding:10px; width:100%; box-sizing:border-box; }
button.send { background:#ff6b81; color:white; border:none; margin-top:5px; cursor:pointer; border-radius:20px; font-weight:bold; transition:0.3s; padding:10px 15px;}
button.send:hover { background:#ff4757; }

/* Jeu */
.question-card { background:#fff0f5; padding:25px; border-radius:25px; text-align:center; font-size:1.3em; color:#ff6b81; box-shadow:0 4px 15px rgba(0,0,0,0.15); margin-top:20px; transition:transform 0.3s, box-shadow 0.3s; }
.question-card:hover { transform:translateY(-5px); box-shadow:0 6px 20px rgba(0,0,0,0.2);}
button.next { background:#ff6b81; color:white; border:none; padding:12px 20px; border-radius:25px; cursor:pointer; font-weight:bold; margin-top:15px; transition:0.3s; }
button.next:hover { background:#ff4757; }

/* Responsive */
@media(max-width:900px){ .events-grid{grid-template-columns:repeat(2,1fr);} }
@media(max-width:600px){ .events-grid{grid-template-columns:1fr;} nav{flex-direction:column;} nav button{margin:5px 0;} }
</style>
</head>
<body>

<header>Notre Petit Monde ğŸ’–</header>

<nav>
  <button onclick="showSection('souvenirs')">Souvenirs</button>
  <button onclick="showSection('chat')">Chat</button>
  <button onclick="showSection('jeu')">Jeu</button>
</nav>

<!-- SOUVENIRS -->
<div id="souvenirs" class="section">
  <button class="add-btn" onclick="openAddPopup()">Ajouter un souvenir ğŸ’Œ</button>
  <div id="eventsGrid" class="events-grid"></div>
</div>

<!-- CHAT -->
<div id="chat" class="section">
  <h2 style="text-align:center; color:#ff6b81; font-family:'Great Vibes', cursive;">ğŸ’Œ Chat ğŸ’Œ</h2>
  <div class="chat-container" id="chatMessages"></div>
  <textarea id="chatInput" placeholder="Tape ton message..."></textarea>
  <button class="send" onclick="sendMessage()">Envoyer ğŸ’–</button>
</div>

<!-- JEU -->
<div id="jeu" class="section">
  <h2 style="text-align:center; color:#ff6b81; font-family:'Great Vibes', cursive;">ğŸ’– Jeu ğŸ’–</h2>
  <button class="next" onclick="nextQuestion()">Nouvelle question ğŸ’Œ</button>
  <div class="question-card" id="question">Clique sur le bouton pour commencer !</div>
</div>

<!-- POPUP AJOUT -->
<div id="addPopup" class="popup">
  <div class="popup-content add-popup">
    <button class="popup-close" onclick="closeAddPopup()">Fermer</button>
    <h3>Ajouter un souvenir ğŸ’–</h3>
    <input type="text" id="eventName" placeholder="Nom de l'Ã©vÃ©nement">
    <input type="date" id="eventDate">
    <input type="text" id="eventLocation" placeholder="Lieu">
    <input type="file" id="eventMedia" multiple accept="image/*,video/*">
    <button onclick="addEvent()">Ajouter ğŸ’Œ</button>
  </div>
</div>

<!-- POPUP DETAILS -->
<div id="popup" class="popup">
  <div class="popup-content">
    <button class="popup-close" onclick="closePopup()">Fermer</button>
    <div id="popupDetails"></div>
  </div>
</div>

<script>
// ===== SUPABASE CONFIG =====
const SUPABASE_URL = 'https://rzibufafvrxnbanbnopt.supabase.co'; // remplace par ton URL
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6aWJ1ZmFmdnJ4bmJhbmJub3B0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjUyNDUsImV4cCI6MjA3OTk0MTI0NX0.hluW9vy-z1Dass6z_q2kLrSdSobzKgNo3WKktCB_92s'; // remplace par ta clÃ©
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ===== SECTIONS =====
function showSection(name){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(name).classList.add('active');
}
showSection('souvenirs');

// ===== SOUVENIRS =====
const chatContainer=document.getElementById('chatMessages');
const chatInput=document.getElementById('chatInput');
  
const events=[];
function openAddPopup(){ document.getElementById('addPopup').style.display='flex'; }
function closeAddPopup(){ document.getElementById('addPopup').style.display='none'; }

function addEvent(){
  const name=document.getElementById('eventName').value;
  const date=document.getElementById('eventDate').value;
  const location=document.getElementById('eventLocation').value;
  const mediaInput=document.getElementById('eventMedia');
  const mediaFiles=Array.from(mediaInput.files);
  if(!name||!date) return alert("Nom et date obligatoires ğŸ’–");
  const media=[];
  let count=0;
  if(mediaFiles.length===0){ events.push({name,date,location,media:[]}); renderEvents(); closeAddPopup(); }
  mediaFiles.forEach(file=>{
    const reader=new FileReader();
    reader.onload=function(e){
      media.push({name:file.name,type:file.type,url:e.target.result});
      count++;
      if(count===mediaFiles.length){ events.push({name,date,location,media}); renderEvents(); closeAddPopup(); }
    };
    reader.readAsDataURL(file);
  });
  document.getElementById('eventName').value='';
  document.getElementById('eventDate').value='';
  document.getElementById('eventLocation').value='';
  mediaInput.value='';
}

function renderEvents(){
  const grid=document.getElementById('eventsGrid');
  grid.innerHTML='';
  events.forEach(e=>{
    const div=document.createElement('div'); div.className='event-card';
    let mediaHTML='<div style="height:180px;background:#ffe0e6;"></div>';
    if(e.media.length>0){
      const rand=Math.floor(Math.random()*e.media.length);
      const m=e.media[rand];
      if(m.type.startsWith('image')) mediaHTML=`<img src="${m.url}" alt="${e.name}">`;
      else if(m.type.startsWith('video')) mediaHTML=`<video src="${m.url}" autoplay muted loop></video>`;
    }
    div.innerHTML=mediaHTML+`<div class="event-info"><h3>ğŸ’Œ ${e.name}</h3><p>${e.date}</p><p>${e.location||'-'}</p></div>`;
    div.onclick=()=>openPopup(e);
    grid.appendChild(div);
  });
}

function openPopup(event){
  const popup=document.getElementById('popup');
  const details=document.getElementById('popupDetails');
  details.innerHTML=`<h3>ğŸ’– ${event.name}</h3><p>Date : ${event.date}</p><p>Lieu : ${event.location||'-'}</p>`;
  event.media.forEach(m=>{
    if(m.type.startsWith('image')){
      const img=document.createElement('img'); img.src=m.url; details.appendChild(img);
    } else if(m.type.startsWith('video')){
      const vid=document.createElement('video'); vid.src=m.url; vid.controls=true; vid.style.width='100%'; details.appendChild(vid);
    }
  });
  popup.style.display='flex';
}
function closePopup(){ document.getElementById('popup').style.display='none'; }
renderEvents();

// ===== CHAT =====

async function setupChat(){
  const { data: messages } = await supabase.from('messages').select('*').order('created_at');
  renderMessages(messages);

  supabase.channel('public:messages')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'messages' }, payload => {
      renderMessages([payload.new]);
    })
    .subscribe();
}

function renderMessages(messages){
  messages.forEach(msg=>{
    const div=document.createElement('div');
    div.className='message me';
    div.textContent=msg.text;
    chatContainer.appendChild(div);
  });
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function sendMessage(){
  const text = chatInput.value.trim();
  if(!text) return;
  await supabase.from('messages').insert({ text });
  chatInput.value='';
}

setupChat();

// ===== JEU =====
const questions=[
  "Qui de nous deux est le plus romantique ? ğŸ’–",
  "Quelle est notre date prÃ©fÃ©rÃ©e ensemble ? ğŸŒ¹",
  "Quel est le premier film quâ€™on a vu ensemble ? ğŸ¬",
  "Qui rit le plus ? ğŸ˜„",
  "Quelle est notre chanson prÃ©fÃ©rÃ©e ? ğŸ¶",
  "Quelle est la surprise idÃ©ale pour l'autre ? ğŸ"
];
function nextQuestion(){
  const q=questions[Math.floor(Math.random()*questions.length)];
  document.getElementById('question').textContent=q;
}
</script>

</body>
</html>

